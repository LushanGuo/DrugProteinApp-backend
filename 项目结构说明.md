# 项目结构说明

## 项目概述
药物筛选平台 - 基于 Spring Boot + PostgreSQL 的药物筛选和分析系统

## 当前结构

```
New-Protein-Splicing/
├── platform/                    # 主应用模块（Maven 项目）
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── com/drugscreen/platform/
│   │   │   │       ├── config/          # 配置类
│   │   │   │       ├── controller/      # 控制器
│   │   │   │       ├── dto/             # 数据传输对象
│   │   │   │       ├── entity/          # 实体类
│   │   │   │       ├── repository/      # 数据访问层
│   │   │   │       ├── service/         # 业务逻辑层
│   │   │   │       └── PlatformApplication.java
│   │   │   └── resources/
│   │   │       ├── application.properties
│   │   │       ├── 3ddata/              # 3D 结构数据
│   │   │       └── structures/          # 结构文件
│   │   └── test/
│   ├── pom.xml                  # Maven 配置文件
│   └── mvnw, mvnw.cmd          # Maven Wrapper
│
├── docking/                     # Vina 对接文件目录
│   ├── 1e9h.pdbqt              # 受体文件
│   └── *.pdbqt                 # 配体文件
│
├── docs/                        # 文档目录
├── scripts/                     # 脚本目录
│
├── 数据库完整初始化脚本.sql      # 数据库初始化
├── 插入模拟数据.sql             # 模拟数据
├── 模块合并说明.md              # 合并说明
├── 数据库字段对照修改说明.md     # 字段对照
├── 后端404问题诊断.md           # 问题诊断
│
└── test-*.bat                   # 测试脚本
```

## 技术栈

### 后端
- **框架**: Spring Boot 3.2.0
- **语言**: Java 17
- **构建工具**: Maven
- **数据库**: PostgreSQL
- **ORM**: Spring Data JPA / Hibernate
- **安全**: Spring Security + JWT
- **工具**: Lombok, Jackson

### 功能模块
1. **用户认证** (`/api/auth`)
   - 注册、登录、忘记密码
   - JWT Token 认证

2. **化合物管理** (`/api/compounds`)
   - 化合物列表、详情
   - 分页查询、搜索

3. **分子对接** (`/api/docking`)
   - 提交对接任务（使用 AutoDock Vina）
   - 查询对接结果
   - 异步执行

4. **ADMET 预测** (`/api/admet`)
   - 提交预测任务
   - 查询预测结果
   - 调用外部 API

5. **3D 可视化** (`/api/visual`)
   - 获取 3D 结构数据
   - 支持蛋白质和配体

6. **综合评分** (`/api/analysis`)
   - 三维评分体系
   - 熔断机制
   - 专家建议

## 启动方式

### 方式 1: IDEA 启动
1. 打开 IDEA
2. 导入项目（选择 `platform` 目录）
3. 等待 Maven 依赖下载完成
4. 运行 `PlatformApplication.java`

### 方式 2: Maven 命令行
```bash
cd platform
mvn spring-boot:run
```

### 方式 3: Maven Wrapper
```bash
cd platform
./mvnw spring-boot:run        # Linux/Mac
mvnw.cmd spring-boot:run      # Windows
```

## 配置说明

### 数据库配置
文件: `platform/src/main/resources/application.properties`

```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/drug_screen_db
spring.datasource.username=postgres
spring.datasource.password=zeng163452
```

### Vina 配置
```properties
vina.path=D:\\tool\\vina\\vina.exe
```

### ADMET API 配置
```properties
admet.api.url=https://admetmesh.scbdd.com/service/evaluation/index
```

## 端口配置
- **后端服务**: http://localhost:8080
- **健康检查**: http://localhost:8080/api/auth/health

## 数据库初始化

### 1. 创建数据库
```sql
CREATE DATABASE drug_screen_db;
```

### 2. 运行初始化脚本
```bash
psql -U postgres -d drug_screen_db -f 数据库完整初始化脚本.sql
```

### 3. 验证数据
```sql
-- 检查表
\dt

-- 检查化合物数量
SELECT COUNT(*) FROM compounds;  -- 应该返回 48
```

## API 测试

### 使用测试脚本
```bash
# 测试所有 API
test-merged-apis.bat

# 测试后端状态
check-platform-status.bat

# 测试认证接口
test-backend.bat
```

### 使用 curl
```bash
# 健康检查
curl http://localhost:8080/api/auth/health

# 化合物列表
curl "http://localhost:8080/api/compounds?page=0&size=10"

# 提交对接任务
curl -X POST "http://localhost:8080/api/docking/submit?compoundId=1"

# 提交 ADMET 预测
curl -X POST "http://localhost:8080/api/admet/predict?compoundId=1"
```

## 常见问题

### 1. IDEA 报错 "Directory does not contain a Gradle build"
**解决方案**: 
- 关闭 IDEA
- 删除 `.idea` 目录
- 重新打开项目，选择 `platform` 目录作为 Maven 项目导入

### 2. 端口被占用
**解决方案**:
```bash
# 查看占用端口的进程
netstat -ano | findstr :8080

# 修改端口（application.properties）
server.port=8081
```

### 3. 数据库连接失败
**解决方案**:
- 确认 PostgreSQL 服务已启动
- 检查用户名和密码
- 验证数据库是否存在

### 4. Vina 执行失败
**解决方案**:
- 检查 Vina 路径是否正确
- 确认 `docking` 目录下有对应的 PDBQT 文件
- 检查文件命名（使用化合物的 english_name）

## 开发建议

### 1. 代码规范
- 使用 Lombok 简化代码
- 统一使用 `ApiResponse<T>` 包装响应
- 添加详细的日志记录

### 2. 测试
- 单元测试：Service 层
- 集成测试：Controller 层
- 端到端测试：完整流程

### 3. 文档
- API 文档：使用 Swagger/OpenAPI
- 代码注释：关键逻辑添加注释
- README：保持更新

## 部署建议

### 1. 打包
```bash
cd platform
mvn clean package
```

### 2. 运行 JAR
```bash
java -jar platform/target/platform-0.0.1-SNAPSHOT.jar
```

### 3. 配置外部化
```bash
java -jar platform.jar --spring.config.location=file:./application.properties
```

## 相关文档
- [模块合并说明](模块合并说明.md)
- [数据库字段对照修改说明](数据库字段对照修改说明.md)
- [后端404问题诊断](后端404问题诊断.md)
- [API 文档](docs/前端接口文档.md)
- [认证接口文档](docs/认证接口文档.md)

## 联系方式
如有问题，请查看文档或提交 Issue。
