# 认证接口文档

## 概述

药物筛选平台提供基于 JWT 的用户认证系统，支持用户注册、登录、手机号/邮箱验证等功能。

## 技术栈

- **认证方式：** JWT (JSON Web Token)
- **加密算法：** BCrypt (密码加密)
- **Token 有效期：** 24 小时
- **安全框架：** Spring Security

---

## API 接口

### 1. 用户注册

**接口：** `POST /api/auth/register`

**请求体：**
```json
{
  "phone": "13800138000",
  "email": "user@example.com",
  "password": "password123",
  "purpose": "科研学习"
}
```

**字段说明：**
- `phone`: 手机号（必填，11位，1开头）
- `email`: 邮箱（必填，符合邮箱格式）
- `password`: 密码（必填，6-20位）
- `purpose`: 使用目的（可选）

**成功响应：**
```json
{
  "success": true,
  "message": "注册成功",
  "data": {
    "id": 1,
    "phone": "13800138000",
    "email": "user@example.com",
    "purpose": "科研学习",
    "isActive": true,
    "createdAt": "2026-01-24T10:30:00"
  }
}
```

**错误响应：**
```json
{
  "success": false,
  "message": "手机号已注册",
  "data": null
}
```

---

### 2. 用户登录

**接口：** `POST /api/auth/login`

**请求体：**
```json
{
  "phoneOrEmail": "13800138000",
  "password": "password123"
}
```

**字段说明：**
- `phoneOrEmail`: 手机号或邮箱（必填）
- `password`: 密码（必填）

**成功响应：**
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "type": "Bearer",
    "expiresIn": 86400000
  }
}
```

**错误响应：**
```json
{
  "success": false,
  "message": "用户不存在",
  "data": null
}
```

或

```json
{
  "success": false,
  "message": "密码错误",
  "data": null
}
```

---

### 3. 检查手机号是否存在

**接口：** `GET /api/auth/check-phone/{phone}`

**路径参数：**
- `phone`: 手机号

**成功响应：**
```json
{
  "success": true,
  "message": "查询成功",
  "data": true
}
```

**说明：**
- `data` 为 `true` 表示手机号已注册
- `data` 为 `false` 表示手机号未注册

---

### 4. 检查邮箱是否存在

**接口：** `GET /api/auth/check-email/{email}`

**路径参数：**
- `email`: 邮箱地址

**成功响应：**
```json
{
  "success": true,
  "message": "查询成功",
  "data": false
}
```

**说明：**
- `data` 为 `true` 表示邮箱已注册
- `data` 为 `false` 表示邮箱未注册

---

### 5. 健康检查

**接口：** `GET /api/auth/health`

**成功响应：**
```json
{
  "success": true,
  "message": "认证服务正常运行",
  "data": "OK"
}
```

---

## 使用 Token

### 在请求头中携带 Token

登录成功后，将返回的 token 添加到后续请求的 Header 中：

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### React Native 示例

```typescript
import axios from 'axios';

// 创建 axios 实例
const api = axios.create({
  baseURL: 'http://10.0.2.2:8080',
});

// 登录
const login = async (phoneOrEmail: string, password: string) => {
  const response = await api.post('/api/auth/login', {
    phoneOrEmail,
    password,
  });
  
  if (response.data.success) {
    const token = response.data.data.token;
    // 保存 token
    await AsyncStorage.setItem('token', token);
    return token;
  }
};

// 使用 token 访问受保护的接口
const getProtectedData = async () => {
  const token = await AsyncStorage.getItem('token');
  
  const response = await api.get('/api/protected-endpoint', {
    headers: {
      Authorization: `Bearer ${token}`,
    },
  });
  
  return response.data;
};
```

---

## 公开接口

以下接口无需认证即可访问：

- `/api/auth/**` - 所有认证相关接口
- `/api/compounds/**` - 化合物查询接口
- `/api/visual/**` - 3D 可视化接口
- `/api/analysis/**` - 分析评分接口

---

## 错误码说明

| HTTP 状态码 | 说明 |
|------------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权（Token 无效或过期） |
| 403 | 禁止访问 |
| 500 | 服务器内部错误 |

---

## 安全建议

### 1. 密码要求

- 长度：6-20 位
- 建议包含大小写字母、数字和特殊字符

### 2. Token 管理

- Token 有效期为 24 小时
- Token 过期后需要重新登录
- 不要在 URL 中传递 Token
- 使用 HTTPS 传输 Token

### 3. 账户安全

- 密码使用 BCrypt 加密存储
- 支持账户禁用功能
- 登录失败会返回明确的错误信息

---

## 测试用例

### 注册新用户

```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "13800138000",
    "email": "test@example.com",
    "password": "test123456",
    "purpose": "科研学习"
  }'
```

### 用户登录

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "phoneOrEmail": "test@example.com",
    "password": "test123456"
  }'
```

### 检查手机号

```bash
curl http://localhost:8080/api/auth/check-phone/13800138000
```

### 使用 Token 访问受保护接口

```bash
curl http://localhost:8080/api/protected-endpoint \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

---

## 常见问题

### Q1: Token 过期怎么办？

A: Token 过期后会返回 401 错误，需要重新登录获取新的 Token。

### Q2: 可以同时用手机号和邮箱登录吗？

A: 是的，登录接口支持手机号或邮箱登录。

### Q3: 密码忘记了怎么办？

A: 当前版本暂不支持密码重置功能，后续版本会添加。

### Q4: 如何退出登录？

A: 前端删除保存的 Token 即可。JWT 是无状态的，服务端不需要处理退出逻辑。

---

## 相关文档

- [前端接口文档](前端接口文档.md)
- [数据库配置指南](DATABASE_SETUP.md)
- [POSTMAN 快速开始](POSTMAN_快速开始.md)

---

**最后更新：** 2026-01-24  
**版本：** v1.0.0
