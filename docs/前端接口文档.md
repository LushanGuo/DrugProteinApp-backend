# è¯ç‰©ç­›é€‰å¹³å° - åç«¯æ¥å£æ–‡æ¡£
## React Native + Expo å‰ç«¯å¯¹æ¥

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| åŸºç¡€ URL | `http://localhost:8080` |
| æ•°æ®æ ¼å¼ | JSON |
| å­—ç¬¦ç¼–ç  | UTF-8 |
| è·¨åŸŸæ”¯æŒ | å·²å¯ç”¨ CORS |

**React Native å¼€å‘ç¯å¢ƒé…ç½®ï¼š**
- Android æ¨¡æ‹Ÿå™¨ï¼š`http://10.0.2.2:8080`
- iOS æ¨¡æ‹Ÿå™¨ï¼š`http://localhost:8080`
- çœŸæœºæµ‹è¯•ï¼š`http://ä½ çš„ç”µè„‘IP:8080`

---

## ğŸ“¡ æ¥å£åˆ—è¡¨

### 1. è·å–åŒ–åˆç‰©åˆ—è¡¨

**æ¥å£ï¼š** `GET /api/compounds`

**åŠŸèƒ½ï¼š** è·å–åŒ–åˆç‰©åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œæœç´¢

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| page | number | å¦ | 0 | é¡µç ï¼ˆä»0å¼€å§‹ï¼‰ |
| size | number | å¦ | 10 | æ¯é¡µæ•°é‡ |
| keyword | string | å¦ | - | æœç´¢å…³é”®è¯ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds
GET /api/compounds?page=0&size=10
GET /api/compounds?keyword=æ§²çš®ç´ 
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "content": [
    {
      "id": 1,
      "name": "é‡‘åˆæ¬¢ç´ ",
      "englishName": "Acacetin",
      "smiles": "COC1=CC=C(C=C1)C2=CC(=O)C3=C(C=C(C=C3O2)O)O",
      "molecularWeight": 284.26,
      "logP": 2.1,
      "category": "é»„é…®ç±»",
      "description": "å¤©ç„¶äº§ç‰©åº“å¯¼å…¥æ•°æ®",
      "receptorPdb": "HEADER    PROTEIN KINASE...",
      "ligandPdbqt": "REMARK  Name = é‡‘åˆæ¬¢ç´ ...",
      "createdAt": "2026-01-19T19:07:01.617"
    }
  ],
  "totalElements": 48,
  "totalPages": 5,
  "pageable": {
    "pageNumber": 0,
    "pageSize": 10
  }
}
```

**æ³¨æ„ï¼š** `receptorPdb` å’Œ `ligandPdbqt` å­—æ®µåŒ…å«å®Œæ•´çš„ 3D ç»“æ„æ•°æ®ï¼Œå¯èƒ½è¾ƒå¤§ã€‚å¦‚æœåªéœ€è¦åŸºæœ¬ä¿¡æ¯ï¼Œè¿™ä¸¤ä¸ªå­—æ®µå¯èƒ½ä¸º null æˆ–è¢«çœç•¥ã€‚

---

### 2. è·å–åŒ–åˆç‰©è¯¦æƒ…

**æ¥å£ï¼š** `GET /api/compounds/{id}`

**åŠŸèƒ½ï¼š** æ ¹æ®IDè·å–åŒ–åˆç‰©è¯¦æƒ…

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds/1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "id": 1,
  "name": "é‡‘åˆæ¬¢ç´ ",
  "englishName": "Acacetin",
  "smiles": "COC1=CC=C(C=C1)C2=CC(=O)C3=C(C=C(C=C3O2)O)O",
  "molecularWeight": 284.26,
  "logP": 2.1,
  "category": "é»„é…®ç±»",
  "description": "å¤©ç„¶äº§ç‰©åº“å¯¼å…¥æ•°æ®",
  "receptorPdb": "HEADER    PROTEIN KINASE...",
  "ligandPdbqt": "REMARK  Name = é‡‘åˆæ¬¢ç´ ...",
  "createdAt": "2026-01-19T19:07:01.617"
}
```

**æ³¨æ„ï¼š** `receptorPdb` å’Œ `ligandPdbqt` å­—æ®µåŒ…å«å®Œæ•´çš„ 3D ç»“æ„æ•°æ®ã€‚

**å¤±è´¥å“åº”ï¼ˆ404ï¼‰ï¼š**
```
HTTP 404 Not Found
```

---

### 3. è·å–åŒ–åˆç‰© 3D ç»“æ„æ•°æ®

**æ¥å£ï¼š** `GET /api/compounds/{id}/structure`

**åŠŸèƒ½ï¼š** è·å–åŒ–åˆç‰©çš„ 3D ç»“æ„æ•°æ®ï¼ˆPDB å’Œ PDBQT æ ¼å¼ï¼‰

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds/1/structure
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "compoundId": 1,
  "compoundName": "é‡‘åˆæ¬¢ç´ ",
  "receptorPdb": "HEADER    PROTEIN KINASE...\nATOM      1  N   ILE A  16...",
  "ligandPdbqt": "REMARK  Name = é‡‘åˆæ¬¢ç´ \nATOM      1  C   UNL     1..."
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| compoundId | number | åŒ–åˆç‰©ID |
| compoundName | string | åŒ–åˆç‰©åç§° |
| receptorPdb | string | å—ä½“è›‹ç™½çš„ PDB æ ¼å¼æ•°æ®ï¼ˆCDK2ï¼‰ |
| ligandPdbqt | string | é…ä½“çš„ PDBQT æ ¼å¼æ•°æ® |

---

### 4. è·å– Top 10 åŒ–åˆç‰©

**æ¥å£ï¼š** `GET /api/compounds/top10`

**åŠŸèƒ½ï¼š** è·å–ç»“åˆäº²å’ŒåŠ›æœ€å¥½çš„å‰ 10 ä¸ªåŒ–åˆç‰©ï¼ˆæŒ‰ affinity å‡åºæ’åˆ—ï¼‰

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds/top10
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
[
  {
    "id": 5,
    "name": "æ§²çš®ç´ ",
    "englishName": "Quercetin",
    "affinity": -11.2,
    "rank": 1,
    "category": "é»„é…®ç±»"
  },
  {
    "id": 12,
    "name": "æŸ“æ–™æœ¨ç´ ",
    "englishName": "Genistein",
    "affinity": -10.8,
    "rank": 2,
    "category": "å¼‚é»„é…®ç±»"
  }
]
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | number | åŒ–åˆç‰©ID |
| name | string | åŒ–åˆç‰©ä¸­æ–‡å |
| englishName | string | åŒ–åˆç‰©è‹±æ–‡å |
| affinity | number | ç»“åˆäº²å’ŒåŠ› (kcal/mol)ï¼Œå€¼è¶Šä½è¶Šå¥½ |
| rank | number | æ’åï¼ˆ1-10ï¼‰ |
| category | string | åŒ–åˆç‰©åˆ†ç±» |

---

### 5. æ ¹æ®åˆ†ç±»è·å–åŒ–åˆç‰©

**æ¥å£ï¼š** `GET /api/compounds/category/{categoryName}`

**åŠŸèƒ½ï¼š** æ ¹æ®åˆ†ç±»åç§°è·å–è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰åŒ–åˆç‰©

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| categoryName | string | æ˜¯ | åˆ†ç±»åç§°ï¼ˆå¦‚ï¼šé»„é…®ç±»ã€ç”Ÿç‰©ç¢±ç±»ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds/category/é»„é…®ç±»
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
[
  {
    "id": 1,
    "name": "é‡‘åˆæ¬¢ç´ ",
    "englishName": "Acacetin",
    "smiles": "COC1=CC=C(C=C1)C2=CC(=O)C3=C(C=C(C=C3O2)O)O",
    "molecularWeight": 284.26,
    "logP": 2.1,
    "category": "é»„é…®ç±»",
    "description": "å¤©ç„¶äº§ç‰©åº“å¯¼å…¥æ•°æ®",
    "createdAt": "2026-01-19T19:07:01.617"
  }
]
```

---

### 6. è·å– 3D å¯è§†åŒ–æ•°æ®

**æ¥å£ï¼š** `GET /api/visual/{compoundId}`

**åŠŸèƒ½ï¼š** è·å–ç”¨äº 3D åˆ†å­æŸ¥çœ‹å™¨çš„å®Œæ•´æ•°æ®ï¼ˆè›‹ç™½ + å¯¹æ¥åçš„é…ä½“ï¼‰

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| compoundId | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/visual/1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "proteinPdb": "HEADER    PROTEIN KINASE...\nATOM      1  N   ILE A  16...",
  "dockedLigandPdbqt": "MODEL 1\nREMARK VINA RESULT:    -9.5...",
  "bindingEnergy": -9.5
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| proteinPdb | string | è›‹ç™½è´¨ PDB å†…å®¹ï¼ˆ1e9h - CDK2ï¼‰ |
| dockedLigandPdbqt | string | å¯¹æ¥åçš„é…ä½“ PDBQT å†…å®¹ |
| bindingEnergy | number | ç»“åˆèƒ½ (kcal/mol)ï¼Œå€¼è¶Šä½è¶Šå¥½ |

**æ³¨æ„ï¼š** æ­¤æ¥å£è¿”å›çš„æ˜¯å¯¹æ¥åçš„é…ä½“æ•°æ®ï¼Œä¸ `/api/compounds/{id}/structure` æ¥å£ä¸åŒã€‚

---

### 7. è®¡ç®—åŒ–åˆç‰©è¯„åˆ†

**æ¥å£ï¼š** `POST /api/analysis/{compoundId}/calculate`

**åŠŸèƒ½ï¼š** åˆ†æåŒ–åˆç‰©å¹¶è®¡ç®—ç»¼åˆè¯„åˆ†

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| compoundId | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
POST /api/analysis/1/calculate
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "compoundId": 1,
  "totalScore": 82.5,
  "affinityScore": 85.0,
  "admetScore": 80.0,
  "druglikenessScore": 82.5,
  "goodTags": ["äº²å’ŒåŠ›ä¼˜ç§€", "ADMET æ€§è´¨è‰¯å¥½", "åˆ†å­é‡é€‚ä¸­"],
  "badTags": [],
  "expertAdvice": "è¯¥åŒ–åˆç‰©é‡‘åˆæ¬¢ç´ ç»¼åˆè¯„åˆ†ä¼˜ç§€ï¼Œå»ºè®®ä¼˜å…ˆè¿›è¡Œå®éªŒéªŒè¯ã€‚å…·æœ‰è‰¯å¥½çš„æˆè¯æ½œåŠ›ã€‚"
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| compoundId | number | åŒ–åˆç‰©ID |
| totalScore | number | æ€»è¯„åˆ†ï¼ˆ0-100ï¼‰ |
| affinityScore | number | äº²å’ŒåŠ›è¯„åˆ† |
| admetScore | number | ADMETæ€§è´¨è¯„åˆ† |
| druglikenessScore | number | ç±»è¯æ€§è¯„åˆ† |
| goodTags | string[] | ä¼˜ç‚¹æ ‡ç­¾ |
| badTags | string[] | ç¼ºç‚¹æ ‡ç­¾ |
| expertAdvice | string | ä¸“å®¶å»ºè®® |

---

## ğŸ“¦ TypeScript ç±»å‹å®šä¹‰

```typescript
// types/api.ts

export interface Compound {
  id: number;
  name: string;
  englishName: string;
  smiles: string;
  molecularWeight: number;
  logP: number;
  category: string;
  description: string;
  receptorPdb?: string;       // å—ä½“è›‹ç™½ PDB æ•°æ®ï¼ˆå¯é€‰ï¼‰
  ligandPdbqt?: string;       // é…ä½“ PDBQT æ•°æ®ï¼ˆå¯é€‰ï¼‰
  createdAt: string;
}

export interface PageResponse<T> {
  content: T[];
  totalElements: number;
  totalPages: number;
  pageable: {
    pageNumber: number;
    pageSize: number;
  };
}

export interface ScoringResult {
  compoundId: number;
  totalScore: number;
  affinityScore: number;
  admetScore: number;
  druglikenessScore: number;
  goodTags: string[];
  badTags: string[];
  expertAdvice: string;
}

export interface StructureData {
  compoundId: number;
  compoundName: string;
  receptorPdb: string;
  ligandPdbqt: string;
}

export interface RankedCompound {
  id: number;
  name: string;
  englishName: string;
  affinity: number;
  rank: number;
  category: string;
}

export interface Visual3DData {
  proteinPdb: string;
  dockedLigandPdbqt: string;
  bindingEnergy: number;
}
```

---

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### API æœåŠ¡å°è£…

```typescript
// services/api.ts
import axios from 'axios';

const API_BASE_URL = 'http://10.0.2.2:8080';  // Androidæ¨¡æ‹Ÿå™¨

const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
});

export const compoundAPI = {
  // è·å–åˆ—è¡¨
  getList: (page = 0, size = 10, keyword = '') => 
    api.get('/api/compounds', { params: { page, size, keyword } }),
  
  // è·å–è¯¦æƒ…
  getDetail: (id: number) => 
    api.get(`/api/compounds/${id}`),
  
  // è·å– 3D ç»“æ„æ•°æ®
  getStructure: (id: number) =>
    api.get(`/api/compounds/${id}/structure`),
  
  // è·å– Top 10 åŒ–åˆç‰©
  getTop10: () =>
    api.get('/api/compounds/top10'),
  
  // æ ¹æ®åˆ†ç±»è·å–åŒ–åˆç‰©
  getByCategory: (categoryName: string) =>
    api.get(`/api/compounds/category/${categoryName}`),
  
  // è·å– 3D å¯è§†åŒ–æ•°æ®
  getVisual3D: (compoundId: number) =>
    api.get(`/api/visual/${compoundId}`),
  
  // è®¡ç®—è¯„åˆ†
  calculateScore: (compoundId: number) =>
    api.post(`/api/analysis/${compoundId}/calculate`),
};
```

### React Native ç»„ä»¶ç¤ºä¾‹

```typescript
import { useState, useEffect } from 'react';
import { compoundAPI } from './services/api';

function CompoundList() {
  const [compounds, setCompounds] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    setLoading(true);
    try {
      const res = await compoundAPI.getList(0, 10);
      setCompounds(res.data.content);
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  return 
    // ä½ çš„UIç»„ä»¶
  );
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¡µç ä»0å¼€å§‹**ï¼Œä¸æ˜¯ä»1å¼€å§‹
2. **æœç´¢æ”¯æŒä¸­æ–‡åå’Œè‹±æ–‡å**æ¨¡ç³ŠåŒ¹é…
3. **CORSå·²å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®
4. **404é”™è¯¯**è¡¨ç¤ºåŒ–åˆç‰©ä¸å­˜åœ¨

### å…³äº 3D ç»“æ„æ•°æ®å­—æ®µ

**receptorPdb å’Œ ligandPdbqt å­—æ®µè¯´æ˜ï¼š**

- è¿™ä¸¤ä¸ªå­—æ®µåœ¨ `GET /api/compounds` å’Œ `GET /api/compounds/{id}` æ¥å£ä¸­éƒ½ä¼šè¿”å›
- åŒ…å«å®Œæ•´çš„ 3D ç»“æ„æ•°æ®ï¼ˆPDB å’Œ PDBQT æ ¼å¼ï¼‰
- æ•°æ®é‡è¾ƒå¤§ï¼ˆæ¯ä¸ªå­—æ®µçº¦ 1-3 KBï¼‰
- å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¿™äº›æ•°æ®ï¼Œå­—æ®µå€¼å¯èƒ½ä¸º `null`

**æ¨èä½¿ç”¨æ–¹å¼ï¼š**

1. **åˆ—è¡¨æŸ¥è¯¢**ï¼šå¦‚æœä¸éœ€è¦ 3D ç»“æ„ï¼Œå¯ä»¥å¿½ç•¥è¿™ä¸¤ä¸ªå­—æ®µ
2. **è¯¦æƒ…æŸ¥è¯¢**ï¼šä½¿ç”¨ `GET /api/compounds/{id}` è·å–å®Œæ•´æ•°æ®
3. **3D å¯è§†åŒ–**ï¼šä½¿ç”¨ä¸“é—¨çš„ `GET /api/compounds/{id}/structure` æ¥å£

**ç¤ºä¾‹ï¼š**
```typescript
// è·å–åˆ—è¡¨æ—¶ï¼Œå¿½ç•¥ 3D ç»“æ„å­—æ®µ
const { receptorPdb, ligandPdbqt, ...basicInfo } = compound;

// éœ€è¦ 3D å¯è§†åŒ–æ—¶ï¼Œä½¿ç”¨ä¸“é—¨æ¥å£
const structure = await compoundAPI.getStructure(compoundId);
```

---

### 8. æäº¤åˆ†å­å¯¹æ¥ä»»åŠ¡

**æ¥å£ï¼š** `POST /api/docking/submit` æˆ– `GET /api/docking/submit`

**åŠŸèƒ½ï¼š** æäº¤åˆ†å­å¯¹æ¥ä»»åŠ¡ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼‰

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| compoundId | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
POST /api/docking/submit?compoundId=1
GET /api/docking/submit?compoundId=1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "success": true,
  "message": "ä»»åŠ¡å·²æäº¤ï¼Œæ­£åœ¨æ‰§è¡Œ",
  "data": "PENDING"
}
```

**å¤±è´¥å“åº”ï¼ˆ400ï¼‰ï¼š**
```json
{
  "success": false,
  "message": "æäº¤å¤±è´¥: åŒ–åˆç‰©ä¸å­˜åœ¨",
  "data": null
}
```

**æ³¨æ„ï¼š** 
- å¯¹æ¥ä»»åŠ¡æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæäº¤åç«‹å³è¿”å›
- éœ€è¦é€šè¿‡æŸ¥è¯¢æ¥å£è·å–å¯¹æ¥ç»“æœ
- å¯¹æ¥è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ ç§’åˆ°å‡ åˆ†é’Ÿ

---

### 9. æŸ¥è¯¢å¯¹æ¥ç»“æœï¼ˆæŒ‰ä»»åŠ¡IDï¼‰

**æ¥å£ï¼š** `GET /api/docking/result/{taskId}`

**åŠŸèƒ½ï¼š** æ ¹æ®ä»»åŠ¡IDæŸ¥è¯¢å¯¹æ¥ç»“æœ

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| taskId | number | æ˜¯ | å¯¹æ¥ä»»åŠ¡IDï¼ˆå³ docking_results è¡¨çš„ idï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/docking/result/1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "success": true,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "id": 1,
    "compoundId": 1,
    "affinity": -9.5,
    "status": "completed",
    "dockedPdbqtContent": "MODEL 1\nREMARK VINA RESULT:    -9.5...",
    "similarityScore": 0.85,
    "updatedAt": "2026-01-28T20:30:15"
  }
}
```

**ä»»åŠ¡ä¸å­˜åœ¨å“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "success": false,
  "message": "ä»»åŠ¡ä¸å­˜åœ¨",
  "data": null
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | number | å¯¹æ¥ä»»åŠ¡ID |
| compoundId | number | åŒ–åˆç‰©ID |
| affinity | number | ç»“åˆäº²å’ŒåŠ› (kcal/mol)ï¼Œå€¼è¶Šä½è¶Šå¥½ |
| status | string | å¯¹æ¥çŠ¶æ€ï¼šcompletedï¼ˆå®Œæˆï¼‰ã€pendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€failedï¼ˆå¤±è´¥ï¼‰ |
| dockedPdbqtContent | string | å¯¹æ¥åçš„é…ä½“ PDBQT å†…å®¹ï¼ˆç”¨äº 3D å¯è§†åŒ–ï¼‰ |
| similarityScore | number | ç›¸ä¼¼åº¦åˆ†æ•° (0.0-1.0) |
| updatedAt | string | æ›´æ–°æ—¶é—´ |

---

### 10. æŸ¥è¯¢å¯¹æ¥ç»“æœï¼ˆæŒ‰åŒ–åˆç‰©IDï¼‰

**æ¥å£ï¼š** `GET /api/docking/result/compound/{compoundId}`

**åŠŸèƒ½ï¼š** æ ¹æ®åŒ–åˆç‰©IDæŸ¥è¯¢æœ€æ–°çš„å¯¹æ¥ç»“æœ

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| compoundId | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/docking/result/compound/1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "success": true,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "id": 1,
    "compoundId": 1,
    "affinity": -9.5,
    "status": "completed",
    "dockedPdbqtContent": "MODEL 1\nREMARK VINA RESULT:    -9.5...",
    "similarityScore": 0.85,
    "updatedAt": "2026-01-28T20:30:15"
  }
}
```

**ç»“æœä¸å­˜åœ¨å“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "success": false,
  "message": "å¯¹æ¥ç»“æœä¸å­˜åœ¨",
  "data": null
}
```

---

### 11. æäº¤ ADMET é¢„æµ‹ä»»åŠ¡

**æ¥å£ï¼š** `POST /api/admet/predict` æˆ– `GET /api/admet/predict`

**åŠŸèƒ½ï¼š** æäº¤ ADMET é¢„æµ‹ä»»åŠ¡å¹¶ç«‹å³è¿”å›ç»“æœ

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| compoundId | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
POST /api/admet/predict?compoundId=1
GET /api/admet/predict?compoundId=1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "success": true,
  "message": "é¢„æµ‹æˆåŠŸ",
  "data": {
    "id": 1,
    "compoundId": 1,
    "hergToxicity": 0.15,
    "amesToxicity": 0,
    "liverToxicity": 0,
    "absorption": 0.75,
    "metabolism": 0.68,
    "updatedAt": "2026-01-28T20:35:20"
  }
}
```

**å¤±è´¥å“åº”ï¼ˆ400ï¼‰ï¼š**
```json
{
  "success": false,
  "message": "é¢„æµ‹å¤±è´¥: åŒ–åˆç‰©ä¸å­˜åœ¨",
  "data": null
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | number | ADMET ç»“æœID |
| compoundId | number | åŒ–åˆç‰©ID |
| hergToxicity | number | hERG å¿ƒè„æ¯’æ€§é£é™© (0-1)ï¼Œå€¼è¶Šä½è¶Šå¥½ |
| amesToxicity | number | Ames è‡´çªå˜æ€§ï¼š0=é˜´æ€§ï¼ˆå®‰å…¨ï¼‰ï¼Œ1=é˜³æ€§ï¼ˆæœ‰é£é™©ï¼‰ |
| liverToxicity | number | è‚æ¯’æ€§ï¼š0=æ— ï¼Œ1=æœ‰ |
| absorption | number | å¸æ”¶æ€§ (0-1)ï¼Œå€¼è¶Šé«˜è¶Šå¥½ |
| metabolism | number | ä»£è°¢ç¨³å®šæ€§ (0-1)ï¼Œå€¼è¶Šé«˜è¶Šå¥½ |
| updatedAt | string | æ›´æ–°æ—¶é—´ |

**ADMET äº”ç»´æŒ‡æ ‡è¯´æ˜ï¼š**

1. **hergToxicityï¼ˆhERG å¿ƒè„æ¯’æ€§ï¼‰**
   - èŒƒå›´ï¼š0.0 - 1.0
   - å«ä¹‰ï¼šå€¼è¶Šä½è¶Šå®‰å…¨
   - å»ºè®®ï¼š< 0.3 ä¸ºä½é£é™©ï¼Œ0.3-0.7 ä¸ºä¸­ç­‰é£é™©ï¼Œ> 0.7 ä¸ºé«˜é£é™©

2. **amesToxicityï¼ˆAmes è‡´çªå˜æ€§ï¼‰**
   - å€¼ï¼š0 æˆ– 1
   - 0 = é˜´æ€§ï¼ˆæ— è‡´çªå˜æ€§ï¼Œå®‰å…¨ï¼‰
   - 1 = é˜³æ€§ï¼ˆæœ‰è‡´çªå˜æ€§ï¼Œæœ‰é£é™©ï¼‰

3. **liverToxicityï¼ˆè‚æ¯’æ€§ï¼‰**
   - å€¼ï¼š0 æˆ– 1
   - 0 = æ— è‚æ¯’æ€§ï¼ˆå®‰å…¨ï¼‰
   - 1 = æœ‰è‚æ¯’æ€§ï¼ˆæœ‰é£é™©ï¼‰

4. **absorptionï¼ˆå¸æ”¶æ€§ï¼‰**
   - èŒƒå›´ï¼š0.0 - 1.0
   - å«ä¹‰ï¼šè¯ç‰©è¢«äººä½“å¸æ”¶çš„èƒ½åŠ›ï¼Œå€¼è¶Šé«˜è¶Šå¥½
   - å»ºè®®ï¼š> 0.7 ä¸ºè‰¯å¥½ï¼Œ0.5-0.7 ä¸ºä¸­ç­‰ï¼Œ< 0.5 ä¸ºè¾ƒå·®

5. **metabolismï¼ˆä»£è°¢ç¨³å®šæ€§ï¼‰**
   - èŒƒå›´ï¼š0.0 - 1.0
   - å«ä¹‰ï¼šè¯ç‰©åœ¨ä½“å†…çš„ä»£è°¢ç¨³å®šæ€§ï¼Œå€¼è¶Šé«˜è¶Šå¥½
   - å»ºè®®ï¼š> 0.6 ä¸ºè‰¯å¥½ï¼Œ0.4-0.6 ä¸ºä¸­ç­‰ï¼Œ< 0.4 ä¸ºè¾ƒå·®

---

### 12. æŸ¥è¯¢ ADMET ç»“æœï¼ˆæŒ‰åŒ–åˆç‰©IDï¼‰

**æ¥å£ï¼š** `GET /api/admet/result/compound/{compoundId}`

**åŠŸèƒ½ï¼š** æ ¹æ®åŒ–åˆç‰©IDæŸ¥è¯¢ ADMET é¢„æµ‹ç»“æœ

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| compoundId | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/admet/result/compound/1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "success": true,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "id": 1,
    "compoundId": 1,
    "hergToxicity": 0.15,
    "amesToxicity": 0,
    "liverToxicity": 0,
    "updatedAt": "2026-01-28T20:35:20"
  }
}
```

**ç»“æœä¸å­˜åœ¨å“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "success": false,
  "message": "ADMETé¢„æµ‹ç»“æœä¸å­˜åœ¨",
  "data": null
}
```

---

### 13. æŸ¥è¯¢ ADMET ç»“æœï¼ˆæŒ‰ç»“æœIDï¼‰

**æ¥å£ï¼š** `GET /api/admet/result/{id}`

**åŠŸèƒ½ï¼š** æ ¹æ®ç»“æœIDæŸ¥è¯¢ ADMET é¢„æµ‹ç»“æœ

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | number | æ˜¯ | ADMET ç»“æœID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/admet/result/1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "success": true,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "id": 1,
    "compoundId": 1,
    "hergToxicity": 0.15,
    "amesToxicity": 0,
    "liverToxicity": 0,
    "updatedAt": "2026-01-28T20:35:20"
  }
}
```

---

## ğŸ“¦ TypeScript ç±»å‹å®šä¹‰ï¼ˆæ›´æ–°ï¼‰

```typescript
// types/api.ts

export interface Compound {
  id: number;
  name: string;
  englishName: string;
  smiles: string;
  molecularWeight: number;
  logP: number;
  category: string;
  description: string;
  receptorPdb?: string;
  ligandPdbqt?: string;
  createdAt: string;
}

export interface PageResponse<T> {
  content: T[];
  totalElements: number;
  totalPages: number;
  pageable: {
    pageNumber: number;
    pageSize: number;
  };
}

export interface ApiResponse<T> {
  success: boolean;
  message: string;
  data: T | null;
}

export interface DockingResult {
  id: number;
  compoundId: number;
  affinity: number;              // ç»“åˆäº²å’ŒåŠ› (kcal/mol)
  status: string;                // completed, pending, failed
  dockedPdbqtContent: string;    // å¯¹æ¥åçš„ PDBQT å†…å®¹
  similarityScore: number;       // ç›¸ä¼¼åº¦åˆ†æ•° (0.0-1.0)
  updatedAt: string;
}

export interface AdmetResult {
  id: number;
  compoundId: number;
  hergToxicity: number;          // hERG å¿ƒè„æ¯’æ€§ (0-1)
  amesToxicity: number;          // Ames è‡´çªå˜æ€§ (0 æˆ– 1)
  liverToxicity: number;         // è‚æ¯’æ€§ (0 æˆ– 1)
  absorption: number;            // å¸æ”¶æ€§ (0-1)
  metabolism: number;            // ä»£è°¢ç¨³å®šæ€§ (0-1)
  updatedAt: string;
}

export interface ScoringResult {
  compoundId: number;
  totalScore: number;
  affinityScore: number;
  admetScore: number;
  druglikenessScore: number;
  goodTags: string[];
  badTags: string[];
  expertAdvice: string;
}

export interface StructureData {
  compoundId: number;
  compoundName: string;
  receptorPdb: string;
  ligandPdbqt: string;
}

export interface RankedCompound {
  id: number;
  name: string;
  englishName: string;
  affinity: number;
  rank: number;
  category: string;
}

export interface Visual3DData {
  proteinPdb: string;
  dockedLigandPdbqt: string;
  bindingEnergy: number;
}
```

---

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹ï¼ˆæ›´æ–°ï¼‰

### API æœåŠ¡å°è£…

```typescript
// services/api.ts
import axios from 'axios';

const API_BASE_URL = 'http://10.0.2.2:8080';  // Androidæ¨¡æ‹Ÿå™¨

const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 30000,  // å¯¹æ¥ä»»åŠ¡å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
});

export const compoundAPI = {
  // è·å–åˆ—è¡¨
  getList: (page = 0, size = 10, keyword = '') => 
    api.get('/api/compounds', { params: { page, size, keyword } }),
  
  // è·å–è¯¦æƒ…
  getDetail: (id: number) => 
    api.get(`/api/compounds/${id}`),
  
  // è·å– 3D ç»“æ„æ•°æ®
  getStructure: (id: number) =>
    api.get(`/api/compounds/${id}/structure`),
  
  // è·å– Top 10 åŒ–åˆç‰©
  getTop10: () =>
    api.get('/api/compounds/top10'),
  
  // æ ¹æ®åˆ†ç±»è·å–åŒ–åˆç‰©
  getByCategory: (categoryName: string) =>
    api.get(`/api/compounds/category/${categoryName}`),
  
  // è·å– 3D å¯è§†åŒ–æ•°æ®
  getVisual3D: (compoundId: number) =>
    api.get(`/api/visual/${compoundId}`),
  
  // è®¡ç®—è¯„åˆ†
  calculateScore: (compoundId: number) =>
    api.post(`/api/analysis/${compoundId}/calculate`),
};

export const dockingAPI = {
  // æäº¤å¯¹æ¥ä»»åŠ¡
  submitDocking: (compoundId: number) =>
    api.post('/api/docking/submit', null, { params: { compoundId } }),
  
  // æŸ¥è¯¢å¯¹æ¥ç»“æœï¼ˆæŒ‰ä»»åŠ¡IDï¼‰
  getResultById: (taskId: number) =>
    api.get(`/api/docking/result/${taskId}`),
  
  // æŸ¥è¯¢å¯¹æ¥ç»“æœï¼ˆæŒ‰åŒ–åˆç‰©IDï¼‰
  getResultByCompoundId: (compoundId: number) =>
    api.get(`/api/docking/result/compound/${compoundId}`),
};

export const admetAPI = {
  // æäº¤ ADMET é¢„æµ‹
  predict: (compoundId: number) =>
    api.post('/api/admet/predict', null, { params: { compoundId } }),
  
  // æŸ¥è¯¢ ADMET ç»“æœï¼ˆæŒ‰åŒ–åˆç‰©IDï¼‰
  getResultByCompoundId: (compoundId: number) =>
    api.get(`/api/admet/result/compound/${compoundId}`),
  
  // æŸ¥è¯¢ ADMET ç»“æœï¼ˆæŒ‰ç»“æœIDï¼‰
  getResultById: (id: number) =>
    api.get(`/api/admet/result/${id}`),
};
```

### React Native ç»„ä»¶ç¤ºä¾‹

#### 1. åˆ†å­å¯¹æ¥ç¤ºä¾‹

```typescript
import { useState } from 'react';
import { dockingAPI } from './services/api';

function DockingComponent({ compoundId }: { compoundId: number }) {
  const [docking, setDocking] = useState<DockingResult | null>(null);
  const [loading, setLoading] = useState(false);

  const handleDocking = async () => {
    setLoading(true);
    try {
      // æäº¤å¯¹æ¥ä»»åŠ¡
      await dockingAPI.submitDocking(compoundId);
      
      // è½®è¯¢æŸ¥è¯¢ç»“æœï¼ˆæ¯2ç§’æŸ¥è¯¢ä¸€æ¬¡ï¼‰
      const interval = setInterval(async () => {
        const res = await dockingAPI.getResultByCompoundId(compoundId);
        if (res.data.success && res.data.data) {
          const result = res.data.data;
          if (result.status === 'completed') {
            setDocking(result);
            setLoading(false);
            clearInterval(interval);
          } else if (result.status === 'failed') {
            alert('å¯¹æ¥å¤±è´¥');
            setLoading(false);
            clearInterval(interval);
          }
        }
      }, 2000);
      
      // 30ç§’ååœæ­¢è½®è¯¢
      setTimeout(() => {
        clearInterval(interval);
        setLoading(false);
      }, 30000);
      
    } catch (error) {
      console.error(error);
      setLoading(false);
    }
  };

  return (
    <View>
      <Button 
        title={loading ? "å¯¹æ¥ä¸­..." : "å¼€å§‹å¯¹æ¥"} 
        onPress={handleDocking}
        disabled={loading}
      />
      {docking && (
        <View>
          <Text>ç»“åˆäº²å’ŒåŠ›: {docking.affinity} kcal/mol</Text>
          <Text>ç›¸ä¼¼åº¦åˆ†æ•°: {(docking.similarityScore * 100).toFixed(1)}%</Text>
        </View>
      )}
    </View>
  );
}
```

#### 2. ADMET é¢„æµ‹ç¤ºä¾‹

```typescript
import { useState } from 'react';
import { admetAPI } from './services/api';

function AdmetComponent({ compoundId }: { compoundId: number }) {
  const [admet, setAdmet] = useState<AdmetResult | null>(null);
  const [loading, setLoading] = useState(false);

  const handlePredict = async () => {
    setLoading(true);
    try {
      const res = await admetAPI.predict(compoundId);
      if (res.data.success) {
        setAdmet(res.data.data);
      }
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  // è®¡ç®— ADMET äº”ç»´å›¾æ•°æ®
  const getRadarData = () => {
    if (!admet) return null;
    
    return {
      labels: ['å¿ƒè„å®‰å…¨æ€§', 'è‡´çªå˜æ€§', 'è‚è„å®‰å…¨æ€§', 'å¸æ”¶æ€§', 'ä»£è°¢ç¨³å®šæ€§'],
      datasets: [{
        data: [
          (1 - admet.hergToxicity) * 100,      // å¿ƒè„å®‰å…¨æ€§ï¼ˆåè½¬ï¼Œå€¼è¶Šä½è¶Šå¥½ï¼‰
          admet.amesToxicity === 0 ? 100 : 0,  // è‡´çªå˜æ€§ï¼ˆåè½¬ï¼Œ0=å®‰å…¨ï¼‰
          admet.liverToxicity === 0 ? 100 : 0, // è‚è„å®‰å…¨æ€§ï¼ˆåè½¬ï¼Œ0=å®‰å…¨ï¼‰
          admet.absorption * 100,              // å¸æ”¶æ€§ï¼ˆå€¼è¶Šé«˜è¶Šå¥½ï¼‰
          admet.metabolism * 100,              // ä»£è°¢ç¨³å®šæ€§ï¼ˆå€¼è¶Šé«˜è¶Šå¥½ï¼‰
        ]
      }]
    };
  };

  return (
    <View>
      <Button 
        title={loading ? "é¢„æµ‹ä¸­..." : "ADMET é¢„æµ‹"} 
        onPress={handlePredict}
        disabled={loading}
      />
      {admet && (
        <View>
          <Text>hERG æ¯’æ€§: {(admet.hergToxicity * 100).toFixed(1)}%</Text>
          <Text>Ames è‡´çªå˜: {admet.amesToxicity === 0 ? 'é˜´æ€§' : 'é˜³æ€§'}</Text>
          <Text>è‚æ¯’æ€§: {admet.liverToxicity === 0 ? 'æ— ' : 'æœ‰'}</Text>
          <Text>å¸æ”¶æ€§: {(admet.absorption * 100).toFixed(1)}%</Text>
          <Text>ä»£è°¢ç¨³å®šæ€§: {(admet.metabolism * 100).toFixed(1)}%</Text>
          
          {/* ä½¿ç”¨é›·è¾¾å›¾åº“æ˜¾ç¤ºäº”ç»´å›¾ */}
          <RadarChart data={getRadarData()} />
        </View>
      )}
    </View>
  );
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹ï¼ˆæ›´æ–°ï¼‰

### åˆ†å­å¯¹æ¥ç›¸å…³

1. **å¼‚æ­¥æ‰§è¡Œ**ï¼šå¯¹æ¥ä»»åŠ¡æ˜¯å¼‚æ­¥çš„ï¼Œæäº¤åéœ€è¦è½®è¯¢æŸ¥è¯¢ç»“æœ
2. **æ‰§è¡Œæ—¶é—´**ï¼šå¯¹æ¥è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ ç§’åˆ°å‡ åˆ†é’Ÿï¼Œå»ºè®®è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
3. **çŠ¶æ€æ£€æŸ¥**ï¼šé€šè¿‡ `status` å­—æ®µåˆ¤æ–­ä»»åŠ¡çŠ¶æ€ï¼ˆcompleted/pending/failedï¼‰
4. **ç»“æœç¼“å­˜**ï¼šå¯¹æ¥ç»“æœä¼šä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥é‡å¤æŸ¥è¯¢

### ADMET é¢„æµ‹ç›¸å…³

1. **åŒæ­¥æ‰§è¡Œ**ï¼šADMET é¢„æµ‹æ˜¯åŒæ­¥çš„ï¼Œæäº¤åç«‹å³è¿”å›ç»“æœ
2. **äº”ç»´æŒ‡æ ‡**ï¼š
   - **hergToxicity**ï¼ˆå¿ƒè„æ¯’æ€§ï¼‰ï¼šè¶Šä½è¶Šå¥½ï¼ˆ< 0.3 ä¸ºä½é£é™©ï¼‰
   - **amesToxicity**ï¼ˆè‡´çªå˜æ€§ï¼‰ï¼š0 è¡¨ç¤ºå®‰å…¨
   - **liverToxicity**ï¼ˆè‚æ¯’æ€§ï¼‰ï¼š0 è¡¨ç¤ºå®‰å…¨
   - **absorption**ï¼ˆå¸æ”¶æ€§ï¼‰ï¼šè¶Šé«˜è¶Šå¥½ï¼ˆ> 0.7 ä¸ºè‰¯å¥½ï¼‰
   - **metabolism**ï¼ˆä»£è°¢ç¨³å®šæ€§ï¼‰ï¼šè¶Šé«˜è¶Šå¥½ï¼ˆ> 0.6 ä¸ºè‰¯å¥½ï¼‰
3. **äº”ç»´é›·è¾¾å›¾**ï¼šå‰ä¸‰ä¸ªæŒ‡æ ‡éœ€è¦åè½¬ï¼ˆå€¼è¶Šä½è¶Šå¥½ï¼‰ï¼Œåä¸¤ä¸ªæŒ‡æ ‡ç›´æ¥ä½¿ç”¨ï¼ˆå€¼è¶Šé«˜è¶Šå¥½ï¼‰

### é€šç”¨æ³¨æ„äº‹é¡¹

1. **é¡µç ä»0å¼€å§‹**ï¼Œä¸æ˜¯ä»1å¼€å§‹
2. **æœç´¢æ”¯æŒä¸­æ–‡åå’Œè‹±æ–‡å**æ¨¡ç³ŠåŒ¹é…
3. **CORSå·²å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®
4. **404é”™è¯¯**è¡¨ç¤ºèµ„æºä¸å­˜åœ¨
5. **è¶…æ—¶è®¾ç½®**ï¼šå»ºè®®è®¾ç½® 30 ç§’è¶…æ—¶ï¼Œç‰¹åˆ«æ˜¯å¯¹æ¥ä»»åŠ¡

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.2.0  
**æ›´æ–°æ—¥æœŸï¼š** 2026-01-28  
**æ›´æ–°å†…å®¹ï¼š** 
- æ·»åŠ åˆ†å­å¯¹æ¥æ¥å£ï¼ˆæäº¤ä»»åŠ¡ã€æŸ¥è¯¢ç»“æœï¼‰
- æ·»åŠ  ADMET é¢„æµ‹æ¥å£ï¼ˆé¢„æµ‹ã€æŸ¥è¯¢ç»“æœï¼‰
- æ›´æ–° TypeScript ç±»å‹å®šä¹‰
- æ·»åŠ  React Native ä½¿ç”¨ç¤ºä¾‹
- æ·»åŠ  ADMET äº”ç»´å›¾æ•°æ®å¤„ç†ç¤ºä¾‹
