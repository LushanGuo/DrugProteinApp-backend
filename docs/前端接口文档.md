# è¯ç‰©ç­›é€‰å¹³å° - åç«¯æ¥å£æ–‡æ¡£
## React Native + Expo å‰ç«¯å¯¹æ¥

---

## ğŸ“‹ åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| åŸºç¡€ URL | `http://localhost:8080` |
| æ•°æ®æ ¼å¼ | JSON |
| å­—ç¬¦ç¼–ç  | UTF-8 |
| è·¨åŸŸæ”¯æŒ | å·²å¯ç”¨ CORS |

**React Native å¼€å‘ç¯å¢ƒé…ç½®ï¼š**
- Android æ¨¡æ‹Ÿå™¨ï¼š`http://10.0.2.2:8080`
- iOS æ¨¡æ‹Ÿå™¨ï¼š`http://localhost:8080`
- çœŸæœºæµ‹è¯•ï¼š`http://ä½ çš„ç”µè„‘IP:8080`

---

## ğŸ“¡ æ¥å£åˆ—è¡¨

### 1. è·å–åŒ–åˆç‰©åˆ—è¡¨

**æ¥å£ï¼š** `GET /api/compounds`

**åŠŸèƒ½ï¼š** è·å–åŒ–åˆç‰©åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µå’Œæœç´¢

**è¯·æ±‚å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| page | number | å¦ | 0 | é¡µç ï¼ˆä»0å¼€å§‹ï¼‰ |
| size | number | å¦ | 10 | æ¯é¡µæ•°é‡ |
| keyword | string | å¦ | - | æœç´¢å…³é”®è¯ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds
GET /api/compounds?page=0&size=10
GET /api/compounds?keyword=æ§²çš®ç´ 
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "content": [
    {
      "id": 1,
      "name": "é‡‘åˆæ¬¢ç´ ",
      "englishName": "Acacetin",
      "smiles": "COC1=CC=C(C=C1)C2=CC(=O)C3=C(C=C(C=C3O2)O)O",
      "molecularWeight": 284.26,
      "logP": 2.1,
      "category": "é»„é…®ç±»",
      "description": "å¤©ç„¶äº§ç‰©åº“å¯¼å…¥æ•°æ®",
      "receptorPdb": "HEADER    PROTEIN KINASE...",
      "ligandPdbqt": "REMARK  Name = é‡‘åˆæ¬¢ç´ ...",
      "createdAt": "2026-01-19T19:07:01.617"
    }
  ],
  "totalElements": 48,
  "totalPages": 5,
  "pageable": {
    "pageNumber": 0,
    "pageSize": 10
  }
}
```

**æ³¨æ„ï¼š** `receptorPdb` å’Œ `ligandPdbqt` å­—æ®µåŒ…å«å®Œæ•´çš„ 3D ç»“æ„æ•°æ®ï¼Œå¯èƒ½è¾ƒå¤§ã€‚å¦‚æœåªéœ€è¦åŸºæœ¬ä¿¡æ¯ï¼Œè¿™ä¸¤ä¸ªå­—æ®µå¯èƒ½ä¸º null æˆ–è¢«çœç•¥ã€‚

---

### 2. è·å–åŒ–åˆç‰©è¯¦æƒ…

**æ¥å£ï¼š** `GET /api/compounds/{id}`

**åŠŸèƒ½ï¼š** æ ¹æ®IDè·å–åŒ–åˆç‰©è¯¦æƒ…

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds/1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "id": 1,
  "name": "é‡‘åˆæ¬¢ç´ ",
  "englishName": "Acacetin",
  "smiles": "COC1=CC=C(C=C1)C2=CC(=O)C3=C(C=C(C=C3O2)O)O",
  "molecularWeight": 284.26,
  "logP": 2.1,
  "category": "é»„é…®ç±»",
  "description": "å¤©ç„¶äº§ç‰©åº“å¯¼å…¥æ•°æ®",
  "receptorPdb": "HEADER    PROTEIN KINASE...",
  "ligandPdbqt": "REMARK  Name = é‡‘åˆæ¬¢ç´ ...",
  "createdAt": "2026-01-19T19:07:01.617"
}
```

**æ³¨æ„ï¼š** `receptorPdb` å’Œ `ligandPdbqt` å­—æ®µåŒ…å«å®Œæ•´çš„ 3D ç»“æ„æ•°æ®ã€‚

**å¤±è´¥å“åº”ï¼ˆ404ï¼‰ï¼š**
```
HTTP 404 Not Found
```

---

### 3. è·å–åŒ–åˆç‰© 3D ç»“æ„æ•°æ®

**æ¥å£ï¼š** `GET /api/compounds/{id}/structure`

**åŠŸèƒ½ï¼š** è·å–åŒ–åˆç‰©çš„ 3D ç»“æ„æ•°æ®ï¼ˆPDB å’Œ PDBQT æ ¼å¼ï¼‰

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| id | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds/1/structure
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "compoundId": 1,
  "compoundName": "é‡‘åˆæ¬¢ç´ ",
  "receptorPdb": "HEADER    PROTEIN KINASE...\nATOM      1  N   ILE A  16...",
  "ligandPdbqt": "REMARK  Name = é‡‘åˆæ¬¢ç´ \nATOM      1  C   UNL     1..."
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| compoundId | number | åŒ–åˆç‰©ID |
| compoundName | string | åŒ–åˆç‰©åç§° |
| receptorPdb | string | å—ä½“è›‹ç™½çš„ PDB æ ¼å¼æ•°æ®ï¼ˆCDK2ï¼‰ |
| ligandPdbqt | string | é…ä½“çš„ PDBQT æ ¼å¼æ•°æ® |

---

### 4. è·å– Top 10 åŒ–åˆç‰©

**æ¥å£ï¼š** `GET /api/compounds/top10`

**åŠŸèƒ½ï¼š** è·å–ç»“åˆäº²å’ŒåŠ›æœ€å¥½çš„å‰ 10 ä¸ªåŒ–åˆç‰©ï¼ˆæŒ‰ affinity å‡åºæ’åˆ—ï¼‰

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds/top10
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
[
  {
    "id": 5,
    "name": "æ§²çš®ç´ ",
    "englishName": "Quercetin",
    "affinity": -11.2,
    "rank": 1,
    "category": "é»„é…®ç±»"
  },
  {
    "id": 12,
    "name": "æŸ“æ–™æœ¨ç´ ",
    "englishName": "Genistein",
    "affinity": -10.8,
    "rank": 2,
    "category": "å¼‚é»„é…®ç±»"
  }
]
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | number | åŒ–åˆç‰©ID |
| name | string | åŒ–åˆç‰©ä¸­æ–‡å |
| englishName | string | åŒ–åˆç‰©è‹±æ–‡å |
| affinity | number | ç»“åˆäº²å’ŒåŠ› (kcal/mol)ï¼Œå€¼è¶Šä½è¶Šå¥½ |
| rank | number | æ’åï¼ˆ1-10ï¼‰ |
| category | string | åŒ–åˆç‰©åˆ†ç±» |

---

### 5. æ ¹æ®åˆ†ç±»è·å–åŒ–åˆç‰©

**æ¥å£ï¼š** `GET /api/compounds/category/{categoryName}`

**åŠŸèƒ½ï¼š** æ ¹æ®åˆ†ç±»åç§°è·å–è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰åŒ–åˆç‰©

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| categoryName | string | æ˜¯ | åˆ†ç±»åç§°ï¼ˆå¦‚ï¼šé»„é…®ç±»ã€ç”Ÿç‰©ç¢±ç±»ï¼‰ |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/compounds/category/é»„é…®ç±»
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
[
  {
    "id": 1,
    "name": "é‡‘åˆæ¬¢ç´ ",
    "englishName": "Acacetin",
    "smiles": "COC1=CC=C(C=C1)C2=CC(=O)C3=C(C=C(C=C3O2)O)O",
    "molecularWeight": 284.26,
    "logP": 2.1,
    "category": "é»„é…®ç±»",
    "description": "å¤©ç„¶äº§ç‰©åº“å¯¼å…¥æ•°æ®",
    "createdAt": "2026-01-19T19:07:01.617"
  }
]
```

---

### 6. è·å– 3D å¯è§†åŒ–æ•°æ®

**æ¥å£ï¼š** `GET /api/visual/{compoundId}`

**åŠŸèƒ½ï¼š** è·å–ç”¨äº 3D åˆ†å­æŸ¥çœ‹å™¨çš„å®Œæ•´æ•°æ®ï¼ˆè›‹ç™½ + å¯¹æ¥åçš„é…ä½“ï¼‰

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| compoundId | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/visual/1
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "proteinPdb": "HEADER    PROTEIN KINASE...\nATOM      1  N   ILE A  16...",
  "dockedLigandPdbqt": "MODEL 1\nREMARK VINA RESULT:    -9.5...",
  "bindingEnergy": -9.5
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| proteinPdb | string | è›‹ç™½è´¨ PDB å†…å®¹ï¼ˆ1e9h - CDK2ï¼‰ |
| dockedLigandPdbqt | string | å¯¹æ¥åçš„é…ä½“ PDBQT å†…å®¹ |
| bindingEnergy | number | ç»“åˆèƒ½ (kcal/mol)ï¼Œå€¼è¶Šä½è¶Šå¥½ |

**æ³¨æ„ï¼š** æ­¤æ¥å£è¿”å›çš„æ˜¯å¯¹æ¥åçš„é…ä½“æ•°æ®ï¼Œä¸ `/api/compounds/{id}/structure` æ¥å£ä¸åŒã€‚

---

### 7. è®¡ç®—åŒ–åˆç‰©è¯„åˆ†

**æ¥å£ï¼š** `POST /api/analysis/{compoundId}/calculate`

**åŠŸèƒ½ï¼š** åˆ†æåŒ–åˆç‰©å¹¶è®¡ç®—ç»¼åˆè¯„åˆ†

**è·¯å¾„å‚æ•°ï¼š**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| compoundId | number | æ˜¯ | åŒ–åˆç‰©ID |

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
POST /api/analysis/1/calculate
```

**æˆåŠŸå“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "compoundId": 1,
  "totalScore": 82.5,
  "affinityScore": 85.0,
  "admetScore": 80.0,
  "druglikenessScore": 82.5,
  "goodTags": ["äº²å’ŒåŠ›ä¼˜ç§€", "ADMET æ€§è´¨è‰¯å¥½", "åˆ†å­é‡é€‚ä¸­"],
  "badTags": [],
  "expertAdvice": "è¯¥åŒ–åˆç‰©é‡‘åˆæ¬¢ç´ ç»¼åˆè¯„åˆ†ä¼˜ç§€ï¼Œå»ºè®®ä¼˜å…ˆè¿›è¡Œå®éªŒéªŒè¯ã€‚å…·æœ‰è‰¯å¥½çš„æˆè¯æ½œåŠ›ã€‚"
}
```

**å“åº”å­—æ®µè¯´æ˜ï¼š**

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| compoundId | number | åŒ–åˆç‰©ID |
| totalScore | number | æ€»è¯„åˆ†ï¼ˆ0-100ï¼‰ |
| affinityScore | number | äº²å’ŒåŠ›è¯„åˆ† |
| admetScore | number | ADMETæ€§è´¨è¯„åˆ† |
| druglikenessScore | number | ç±»è¯æ€§è¯„åˆ† |
| goodTags | string[] | ä¼˜ç‚¹æ ‡ç­¾ |
| badTags | string[] | ç¼ºç‚¹æ ‡ç­¾ |
| expertAdvice | string | ä¸“å®¶å»ºè®® |

---

## ğŸ“¦ TypeScript ç±»å‹å®šä¹‰

```typescript
// types/api.ts

export interface Compound {
  id: number;
  name: string;
  englishName: string;
  smiles: string;
  molecularWeight: number;
  logP: number;
  category: string;
  description: string;
  receptorPdb?: string;       // å—ä½“è›‹ç™½ PDB æ•°æ®ï¼ˆå¯é€‰ï¼‰
  ligandPdbqt?: string;       // é…ä½“ PDBQT æ•°æ®ï¼ˆå¯é€‰ï¼‰
  createdAt: string;
}

export interface PageResponse<T> {
  content: T[];
  totalElements: number;
  totalPages: number;
  pageable: {
    pageNumber: number;
    pageSize: number;
  };
}

export interface ScoringResult {
  compoundId: number;
  totalScore: number;
  affinityScore: number;
  admetScore: number;
  druglikenessScore: number;
  goodTags: string[];
  badTags: string[];
  expertAdvice: string;
}

export interface StructureData {
  compoundId: number;
  compoundName: string;
  receptorPdb: string;
  ligandPdbqt: string;
}

export interface RankedCompound {
  id: number;
  name: string;
  englishName: string;
  affinity: number;
  rank: number;
  category: string;
}

export interface Visual3DData {
  proteinPdb: string;
  dockedLigandPdbqt: string;
  bindingEnergy: number;
}
```

---

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### API æœåŠ¡å°è£…

```typescript
// services/api.ts
import axios from 'axios';

const API_BASE_URL = 'http://10.0.2.2:8080';  // Androidæ¨¡æ‹Ÿå™¨

const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
});

export const compoundAPI = {
  // è·å–åˆ—è¡¨
  getList: (page = 0, size = 10, keyword = '') => 
    api.get('/api/compounds', { params: { page, size, keyword } }),
  
  // è·å–è¯¦æƒ…
  getDetail: (id: number) => 
    api.get(`/api/compounds/${id}`),
  
  // è·å– 3D ç»“æ„æ•°æ®
  getStructure: (id: number) =>
    api.get(`/api/compounds/${id}/structure`),
  
  // è·å– Top 10 åŒ–åˆç‰©
  getTop10: () =>
    api.get('/api/compounds/top10'),
  
  // æ ¹æ®åˆ†ç±»è·å–åŒ–åˆç‰©
  getByCategory: (categoryName: string) =>
    api.get(`/api/compounds/category/${categoryName}`),
  
  // è·å– 3D å¯è§†åŒ–æ•°æ®
  getVisual3D: (compoundId: number) =>
    api.get(`/api/visual/${compoundId}`),
  
  // è®¡ç®—è¯„åˆ†
  calculateScore: (compoundId: number) =>
    api.post(`/api/analysis/${compoundId}/calculate`),
};
```

### React Native ç»„ä»¶ç¤ºä¾‹

```typescript
import { useState, useEffect } from 'react';
import { compoundAPI } from './services/api';

function CompoundList() {
  const [compounds, setCompounds] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    setLoading(true);
    try {
      const res = await compoundAPI.getList(0, 10);
      setCompounds(res.data.content);
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  return 
    // ä½ çš„UIç»„ä»¶
  );
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¡µç ä»0å¼€å§‹**ï¼Œä¸æ˜¯ä»1å¼€å§‹
2. **æœç´¢æ”¯æŒä¸­æ–‡åå’Œè‹±æ–‡å**æ¨¡ç³ŠåŒ¹é…
3. **CORSå·²å¯ç”¨**ï¼Œæ— éœ€é¢å¤–é…ç½®
4. **404é”™è¯¯**è¡¨ç¤ºåŒ–åˆç‰©ä¸å­˜åœ¨

### å…³äº 3D ç»“æ„æ•°æ®å­—æ®µ

**receptorPdb å’Œ ligandPdbqt å­—æ®µè¯´æ˜ï¼š**

- è¿™ä¸¤ä¸ªå­—æ®µåœ¨ `GET /api/compounds` å’Œ `GET /api/compounds/{id}` æ¥å£ä¸­éƒ½ä¼šè¿”å›
- åŒ…å«å®Œæ•´çš„ 3D ç»“æ„æ•°æ®ï¼ˆPDB å’Œ PDBQT æ ¼å¼ï¼‰
- æ•°æ®é‡è¾ƒå¤§ï¼ˆæ¯ä¸ªå­—æ®µçº¦ 1-3 KBï¼‰
- å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¿™äº›æ•°æ®ï¼Œå­—æ®µå€¼å¯èƒ½ä¸º `null`

**æ¨èä½¿ç”¨æ–¹å¼ï¼š**

1. **åˆ—è¡¨æŸ¥è¯¢**ï¼šå¦‚æœä¸éœ€è¦ 3D ç»“æ„ï¼Œå¯ä»¥å¿½ç•¥è¿™ä¸¤ä¸ªå­—æ®µ
2. **è¯¦æƒ…æŸ¥è¯¢**ï¼šä½¿ç”¨ `GET /api/compounds/{id}` è·å–å®Œæ•´æ•°æ®
3. **3D å¯è§†åŒ–**ï¼šä½¿ç”¨ä¸“é—¨çš„ `GET /api/compounds/{id}/structure` æ¥å£

**ç¤ºä¾‹ï¼š**
```typescript
// è·å–åˆ—è¡¨æ—¶ï¼Œå¿½ç•¥ 3D ç»“æ„å­—æ®µ
const { receptorPdb, ligandPdbqt, ...basicInfo } = compound;

// éœ€è¦ 3D å¯è§†åŒ–æ—¶ï¼Œä½¿ç”¨ä¸“é—¨æ¥å£
const structure = await compoundAPI.getStructure(compoundId);
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.1.0  
**æ›´æ–°æ—¥æœŸï¼š** 2026-01-22  
**æ›´æ–°å†…å®¹ï¼š** 
- æ·»åŠ  Top 10 åŒ–åˆç‰©æ¥å£
- æ·»åŠ æŒ‰åˆ†ç±»æŸ¥è¯¢æ¥å£
- æ·»åŠ  3D å¯è§†åŒ–æ•°æ®æ¥å£
- æ›´æ–° TypeScript ç±»å‹å®šä¹‰
